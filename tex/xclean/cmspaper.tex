\documentclass{cmspaper}
\usepackage{graphicx}
\renewcommand\arraystretch{1.5}

%%%% needed for the colored notes in the text
%%%% can be removed in final version
\usepackage{color}

\begin{document}

% *** TITLE PAGE ****************************************************************

\begin{titlepage}

% select one of the following and type in the proper number:
% \cmsnote{2008/000}
\internalnote{2009/000}
% \conferencereport{2005/000}
\date{\today}

\title{A Cross-Cleaning Package}

\begin{Authlist}
    Christian~Autermann, Benedikt~Mura, Friederike~Nowak, Christian~Sander, Peter~Schleper
    \Instfoot{uhh}{Universit\"at Hamburg, Germany}
    Jean-Roch~Vlimant
    \Instfoot{ucsb}{University of California, Santa Barbara, USA}
    % Anyone else ???
\end{Authlist}

% if needed, use the following:
%\collaboration{Flying Saucers Investigation Group}
%\collaboration{CMS collaboration}

%\Anotfoot{a}{On leave from prison}
%\Anotfoot{b}{Now at the Moon}
% if needed, use the following:
%\conference{Presented at {\it Physics Rumours}, Coconut Island, April 1, 2005}
%\submitted{Submitted to {\it Physics Rumours}}
%\note{Preliminary version}

% --- ABSTRACT -----------------------------------------------------------------

\begin{abstract}
Physics analysis in CMS is based on the reconstruction of high-level objects
like electrons, photons, muons, taus, and jets. However, energy depositions in
the detector are not uniquely assigned to one reconstructed physics object but
can contribute to several of them. This leads to an overlap of the objects and
a double counting of energy.

This note discusses a cross-cleaning package which provides algorithms to
identify the overlap of any two objects. The package provides a framework to
correct objects for the double counted energy and to remove duplicates. The
cross-cleaning package is designed to run on {\sc PAT} objects.
\end{abstract} 

% ------------------------------------------------------------------------------

\end{titlepage}

% *** TOC **********************************************************************

\setcounter{page}{2}%JPP
%\tableofcontents

% *** INTRODUCTION *************************************************************

\newpage
\section{Introduction}

In CMS event reconstruction, except for particle-flow algorithms, each type of
physics object is build from the detector information by a dedicated algorithm,
independent of the reconstruction of other kinds of objects. It is not
uncommon in this procedure that two or more objects of different type end up
with common constituents.  While algorithms for object identification usually
select 'good' objects from all reconstructed ones within the same collection,
the ambiguity between two objects in distinct collections can still remain.
This multiple counting of energy must be avoided in order to obtain an optimal
energy resolutions of these objects. This is especially true for the missing
transverse energy (MET), when calculated from the final-state objects.

Overlapping objects must be identified and the energy be assigned uniquely to
one of the candidates. This cross-cleaning tool~\cite{package} is flexible enough to allow the
implementation of different splitting algorithm between objects. If more than
two objects share energy, circular dependencies may arise. These possible
interferences are dealt with, so that the outcome of cross-cleaned objects does
not depend on the order in which the cleaning algorithms are called.
All energy overlaps between any two objects will be removed.

The details of such a cleaning are of course depending on the object definition
and therefore particular to each analysis. In order to get optimal results for
a specific analysis, e.g. an optimal electron resolution, or an optimal MET
resolution, analysis dependent cross cleaning studies are inevitable. The
chosen algorithm parameters should be considered default bench mark values.

The inpus to the cleaning algorithm are collections of physics objects which pass the
identification requirements chosen for the particular analysis. No input
collection will be changed, but new cross-cleaned collections will be created.
The cross-cleaning does not replace a good object-ID selection, but is meant to
remove the remaining ambiguities.

This approach is motivated by the typical topologies in a SUSY analysis,
including many jets, leptons and missing transverse energy. The implementation
resembles some features of a software package formerly used in the SUSY PAG,
the SusyAnalyzer~\cite{wikiSusyAnalyzer}.

In the next two sections the general steps of the cross cleaning are described.
Then the binary cleaners are explained in detail and their performance is
demonstrated. All configuration parameters of the module including a short
description can be found in the appendix.

% *** THE CROSS-CLEANING FRAMEWORK *********************************************

\section{The Cross-Cleaning-Algorithm Framework}
The cross-cleaning is performed in two steps: First binary cleaners are called.
These are specialized algorithms that search for conflicts in two distinct
collections, determine the shared energy for two overlapping objects and decide
how to deal with it. This for example can be an electron-vs.-jet cleaner, a
muon-vs.-jet cleaner etc.. These binary cleaners do not apply any corrections
on either of the two input collections, but save the result of the cleaning
algorithms in a module internal map.

The key entry in this map is a reference to the object that should be corrected
or discarded, while the associated value contains a vector of objects which are
responsible for this and information on how the object should be corrected. This
scheme is illustrated in Fig.~\ref{fig:Cleaning}. A correction is given by an
energy-momentum fourvector.

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
\begin{center}
\includegraphics[scale=.4]{figures/CleaningMap.eps}
\caption{Schematic view of the input and result of different cleaning
    algorithms. Each algorithm takes two object collections as input and
    creates an entry in the internal cross-cleaning map for each object
    that should be modified.}
\label{fig:Cleaning}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

In a second step, this buffer map is scanned for possible conflicts.
If an object {\it A} is causing a correction to object {\it B} but should
be corrected itself because of object {\it C}, then it might happen that after
applying the correction to {\it A} the correction of {\it B} is no longer
necessary or at least different.
% to the case where first {\it B} is corrected and then {\it A}.
% right, but this case we do not take care of ...
The result of the cross-cleaning must not depend on the order in which objects
are compared, therefore conflicts are resolved before any object is being
modified (cf. Section \ref{mapReso}).

Subsequently the corrections are applied to the objects. Energy corrections for
all jets in the cleaned collection are recalculated to ensure consistency
in the calibration.

A special object in the event is the missing transverse energy. The raw
MET is calculated from calorimeter towers only and will not be changed by this
cross-cleaning. However, the physics object corrections to the MET (due to JES,
muons, ...) can either be
recalculated using the new collections of corrected objects as input, or by
tracking the impact of each cross-cleaning modification on the MET. The first
can be done by the user using the cross-cleaned object collections. This
package provides a corrected MET object using the latter way.
%Both ways should give the same result and the comparison is a valuable
%cross-check. 

The cross-cleaning package is an EDM producer which creates new collections for
the cross-cleaned objects, leaving all input collections unchanged. If for a
specific event no cross-cleaning has taken place, these output collections
contain identical objects as the input collections.  In addition, collections
of dropped objects are created, i.e. if one object was duplicated (e.g. an
electron also reconstructed as a jet), then either object is dropped and
written into a ``dropped'' collection, while the other object remains in the
cleaned output collection.

An association of the cross-cleaned PAT objects in the new collections to the
objects before cleaning is always possible by comparing the references to the
original RECO objects (via the PAT object member function
\\\texttt{originalObjectRef()}). 

All parameters available for the steering of the module are listed in the
appendix. The general setup parameters and their default values can be found in
Tab.~\ref{tab:TurnOnModules}-\ref{tab:JetCorrections} including a short
description.
% ******************************************************************************

\section{Resolving Conflicts}
\label{mapReso}
All overlaps detected in the comparison of collections among each other are
stored in an association map as described above. The next step in the
cleaning procedure consists of finding contradictions in this map and resolving
them. Possible configurations
needing an intervention are:
\begin{enumerate}
    \item Object A is marked to be \textit{deleted} because of overlap with
	object B and marked for \textit{modification} due to a conflict with
	object C;
    \item Object A is marked to be \textit{deleted} because of overlap with
	object B which itself is marked for deletion due to a conflict with
	object C;
    \item A closed loop of dependencies (cf. Fig.~\ref{fig:loopReso}).
\end{enumerate}

% Explain how this can occur, examples
% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.4]{figures/loopConflict.eps}
    \hspace*{1.5cm}
    \includegraphics[scale=0.4]{figures/loopConflictResolved.eps}
    \caption{Left: Circular dependencies in the cross-cleaning before the
    consistency check of the map. Right: Cleared structure without a loop
    afterwards. The arrows point toward the object which is removed in the
    cleaning.}
    \label{fig:loopReso}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

The first case is handled at the point where the clean collections are
being created. The action of deletion gets priority over all other
modifications.

All map entries are inspected in order to find conflicts of the other kinds.
For each entry those modifier objects leading to a deletion are checked whether
they appear themselves in the map as a modified object marked for deletion. If
this is the case a conflict of type 2 was found. As a consequence the
initial action (removal of object A) should not take place and therefore the
corresponding modifier (object B) is removed from object A's list of modifier
objects.

For the detection of a loop of dependencies not only the modifiers of the
starting object must be checked but iteratively all the modifiers' modifier.
Bookkeeping of all objects appearing in the procedure allows the detection of
the loop.

Once a loop has been detected some modifications to the map become necessary.
The idea is to keep the most energetic object of the loop (we choose the
highest in $p_T$). Therefore, the list of modifiers of this kept object is
cleared up by removing all other objects appearing in the loop.  The same is
done for these other objects but in addition the kept object is added as a
modifier marking them for deletion. The new topology is sketched in
Fig.~\ref{fig:loopReso}.

\subsection{Statistics}
The number of conflics depends on the sample and on the acceptance cuts on the
objects, but is not negligible. In a typical SUSY sample (here LM4 with a
statistic of $2\ 000$~events) and all cross-cleaner modules activated around
\(6\) overlaps of objects per event occur. The average number of objects
overlapping with a different specific object was \( \sim 1.003\), where the
maximum number of overlapping objects was found to be \(3\). 

The average number of objects causing another object to be dropped was \(5.5\),
this is dominated by non-isolated photons.
Of these objects, nearly all were required to be modified itself (case 1 of
configurations needing intervention), few were required to be dropped itself (\(\sim
0.0005\), case 2). No loops were found in this sample.

% ******************************************************************************

\section{Electron - Jet Cleaning}
\label{sec:ElecJet}
Electron reconstruction starts from clusters in the electromagnetic calorimeter
whereas calorimeter towers used for jet clustering comprise energy in both the
hadronic and electromagnetic calorimeter. This implies that a fraction of the
ECAL energy might contribute to the reconstruction of two objects, namely an
electron and a jet. It is important to distinguish between the three cases of
\begin{enumerate}
\item a real jet with a high electromagnetic fraction
\item a high $p_T$ electron whose ECAL deposit is included as a tower in a jet
\item an electron and a jet which are located very close together in the
    detector.
\end{enumerate}
Therefore the following procedure includes the possibilities to keep either the
jet or the electron or both objects in the event.

The Electron-Jet cross cleaning was tested on a variety of samples. All
plots in this section were created from either a SUSY LM4 Sample from
Summer08 production\\
(\texttt{/SUSY\_LM4-sftsht/Summer08\_IDEAL\_V11\_redigi\_v1/GEN-SIM-RECO})\\
or a sample of
$Z\rightarrow ee$ events \\(\texttt{/Zee/Summer08\_IDEAL\_V11\_redigi\_v2/GEN-SIM-RECO}).

The PAT objects were generated using the default sequences provided in the
configuration files\\
\texttt{PhysicsTools/PatAlgos/python/patLayer0\_cff.py} and\\
\texttt{PhysicsTools/PatAlgos/python/patLayer1\_cff.py} in the CMSSW\_2\_2\_7
release. Acceptance cuts for the PAT objects as listed in
Tab.~\ref{tab:PATobjCuts} were applied to all samples used in this study.
All other parameters were set as listed in the appendix.

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Selection of PAT Layer 1 objects}
\begin{center}
\begin{tabular}{l|c|c}
\textbf{Object} & \textbf{$p_T$} & \textbf{$|\eta|$} \\ \hline
    Electrons & $>10$\,GeV & $<2.5$  \\\hline
    Muons     & $>10$\,GeV & $<2.5$  \\\hline
    Photons   & $>10$\,GeV & $<2.5$  \\\hline
    Jets      & $>15$\,GeV & $<2.5$
\end{tabular}
\end{center}
\label{tab:PATobjCuts}
\end{table}
% ------------------------------------------------------------------------------

\subsection{Algorithm}
The implemented algorithm is similar to the cleaning in a previous analysis
tool used in the SUSY PAG, the SusyAnalyzer~\cite{wikiSusyAnalyzer}.

In very dense events as predicted for supersymmetric particle production, it is
not uncommon for an electromagnetic object to have shared energy with a jet
(Fig. ~\ref{fig:NbJets}).

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
  \begin{center}
    \includegraphics[scale=1.0]{figures/ElecJet/LM4_no_of_nnj.eps}
    \caption{Number of jets with shared energy for isolated (dashed line) and
    non-isolated (solid line) electrons in an event.}
    \label{fig:NbJets}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

For each electron the three closest jets in \( \eta-\phi\) space are
examined. If this distance is smaller than $\Delta R=1.0$ (configurable), the
objects' constituents are compared in order to determine the amount of energy
which is being shared between the two objects.
This shared energy is calculated by adding up the electromagnetic energy of
those calorimeter towers which are covered by both objects, i.e. all jet towers
containing crystals which are part of the electrons' supercluster.
\footnote{Note, that this is only an approximation to the real energy overlap.
In principle the more precise energies of individual crystals could be used for
calculation but these are not necessarily accessible in all analysis data
formats like e.g. PAT Layer~1 files.}
% Method using individual ECAL crystals 

The starting point for this cleaning should be a collection of well identified
electrons, where the level of identification can be chosen from those provided
by the EGamma POG ~\cite{elecID}. All electrons not passing the identification
requirements are marked for removal if they are sharing energy with a jet.

The treatment of identified electrons depends on their isolation. While the
possible choices for the isolation algorithm include the default PAT options
like cone isolation in the Tracker, hadronic and electromagnetic calorimeter,
the default is a combination of these three, i.e. 
\begin{equation}
    CombRelIso=\frac{a\cdot ECalIso+b\cdot HCalIso+c\cdot TrackIso}{p_T},
    \label{ElIsolation}
\end{equation}
with \(a=b=c=1\). This isolation variable has been suggested by the V+jets
group~\cite{vplusjets}. Figure~\ref{fig:ElectronIsolation} shows this combined
isolation for electrons. The cut at \(0.1\) is recommended in the V+jets
group baseline selection.

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
  \begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_isolation_B.eps}
    \caption{Combined isolation (see Eq. (~\ref{ElIsolation})) for Electrons.}
    \label{fig:ElectronIsolation}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

The electron, if non-isolated, will be removed and the difference between
the electron energy and the shared energy will be added to the jet. This energy
correction is applied vectorially. It is given by the difference of the electron
fourvector and the massless 'shared energy' fourvector.

This fourvector is calculated from the electromagnetic energy of those towers
that overlap with the electrons supercluster. For each
tower an energy vector $(E_x, E_y, E_z)$ is calculated from the electromagnetic
energy and the $\eta$ and $\phi$ coordinates. All the vectors are added
up and finally transformed into a massless fourvector ($E^2=\vec{p}^2$).

For isolated electrons we distinguish two cases:
\begin{enumerate}
\item If the ratio of shared energy and jet energy is greater than a certain
value the jet will be removed. 
\item If the ratio is smaller both objects are kept and the shared energy
fourvector is subtracted from the jet. 
\end{enumerate}
This way, objects very close in $\Delta R$ can be kept
in the events without double counting of energy.  The steps of this procedure
are illustrated in Fig.~\ref{fig:EJCleaning}.

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
  \begin{center}
    \includegraphics[scale=.6]{figures/ElectronJetAlgo_quer.eps}
    \caption{Steps of the electron-jet cleaning.}
    \label{fig:EJCleaning}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

% OK, now there should be s.th. concerning vectorial subtraction vs. scaling.
All cut values are configurable and are listed with their default settings in
Tab.~\ref{tab:ElectronJetPar}.

\subsection{Results and Validation}
In this section the effect of the described procedure on electrons and jets in
the events is studied. 

\subsubsection{Cut Variables}
% (dR, shared energy, isolation) for different matches
As described in the previous section the cleaning algorithm applies cuts on
several variables concerning the electron and jet under investigation. These are
the distance of electron and jet in $\Delta R$ and their shared energy,
normalised to the jet energy. The distributions of these variables are shown
in Fig.~\ref{fig:dR_sE_ElecJet_iso} (isolated electrons, before and after the
cleaning) and Fig.~\ref{fig:dR_sE_ElecJet_noniso} (non-isolated electrons
before cleaning) respectively. By default the CombRelIso variable is considered.

We further investigate four different classes of electron-jet pairs. The
classification is based on the matching of the reconstructed objects
to generator particles produced in the hard process. We distinguish events in
which both, only the electron, only the jet, or none of the objects could be matched to a generated
particle. The matching algorithm provided and used in the PAT applies a $\Delta
R$ matching.

% ------------------------------------------------------------------------------
\begin{figure}[htbp]
\begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_dR_iso_B.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_dR_iso_A.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_sharedE_iso_B.eps}
%    \includegraphics[scale=0.8]{figures/ElecJet/LM4_sharedE_iso_A.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_noteV3_JpT15_dR_modJets.eps}
    \caption{Distance \(\Delta R\)  with the closest jet for isolated electrons
before (upper left) and after (upper right) the electron-jet cross cleaning. 
The shared energy normalized to the jet energy before the cross-cleaning (lower left). 
$\Delta$R to closest electron for jets modified in the cleaning (lower right).}
\label{fig:dR_sE_ElecJet_iso}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{figure}[htbp]
\begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_dR_noniso_B.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_sharedE_noniso_B.eps}
    \caption{Distance in $\Delta R$ and shared energy divided by the jet energy
    of non-isolated electron and closest jet before the electron-jet cross cleaning.}
\label{fig:dR_sE_ElecJet_noniso}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

We observe a peak at $E_{shared}/E_{Jet}=1$ for isolated as well as for
non-isolated electrons (cf. Fig.~\ref{fig:dR_sE_ElecJet_iso} and
\ref{fig:dR_sE_ElecJet_noniso}). The peak contains mostly electrons which have a
matched generated electron but no matched generated parton/jet. Clearly, the
energy deposition of the electron has been reconstructed as a jet. This
motivates the use of a cut on this ratio in order to reject fake jets.  The
effect of the default cut value 0.7 is illustrated in Fig.~\ref{fig:dR_sE_ElecJet_iso}.
The minimal distance between jet and electron is increased in general (upper
row) and in particular for the modified jets where the electron has been kept
(lower right plot).

The peak of many non-isolated electrons with a generator match and large shared
energy is caused by the hard cut on the isolation value which cuts away a
non-negligible number of electrons which can be matched to a generated electron
(Fig.~\ref{fig:ElectronIsolation}). It can be reduced by loosening the
isolation requirement.
The region with lower $E_{shared}/E_{Jet}$ ration is dominated by overlaps
where only the jet could be matched to the generator information, thus
indicating fake electrons which can be removed.


%\clearpage

\subsubsection{Effects of the Cleaning}
While the cleaning is aiming at a reduction of double counted energy it will
nevertheless affect the electron reconstruction quality as non-isolated
electrons are removed from the event. Analyses optimized for electron efficiency
will need to revise the algorithm.

Two control quantities that can be
studied in Monte Carlo are the reconstruction efficiency and the contamination
with fake electrons. Here we define efficiency as the ratio 
\[\frac{\mathrm{No.\ of\ reconstructed\ electrons\ w\ generator\ match}}{\mathrm{No.\ of\ generated\ electrons}}\]
and contamination as
\[\frac{\mathrm{No.\ of\ reconstructed\ electrons\ w/o\ generator\ match
}}{\mathrm{No.\ of\ all\ reconstructed\ electrons}}\]
The intrinsic PAT matching is utilized, the matching efficiency is neglected for
the above reconstruction efficiency and the contamination definition.

With the default settings provided in the appendix a significant drop of the
efficiency is observed (Fig.~\ref{fig:effCont_elec_ElecJet}) . This
corresponds directly to the hard cut on electron isolation
($\mathrm{CombRelIso}<0.1$) which defines the fraction of removed objects. This
drop appears uniformly over the pseudorapidity range and amounts to
about 30\%.  The effect is larger for low $p_T$ electrons which can be
explained by a larger fraction failing the identification requirements and the
higher sensitivity of the relative isolation variable for low $p_T$ objects.

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_efficiency_pt.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_efficiency_eta.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_contamination_pt.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_contamination_eta.eps}
    \caption{Efficiency (upper row) and contamination (lower row) vs. transverse
    momentum (left) and pseudorapidity (right) for electrons of a SUSY LM4
    sample before and after
    the cross-cleaning. The drop in efficiency in the upper plots is a direct
    consequence of the rejection of non-isolated electrons.} \label{fig:effCont_elec_ElecJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

The contamination decreases to a very low level of about 5\% over the entire $p_T$
range and is mostly flat in pseudorapidity. Note that the spikes at
$|\eta|=1.4$, marking the transition from barrel to endcap calorimeter, are
largely reduced after applying the cross-cleaning on those electrons passing the
'LooseElectron' identification.

The reconstruction efficiency of the jets is not affected (Fig.
~\ref{fig:effCont_Jets_ElecJet}). The contamination, however, is slightly reduced
in the range up to $p_T=300$~GeV, where jets have been identified as electrons in
the cleaning.
% ------------------------------------------------------------------------------
\begin{figure}[htb]
\begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_efficiency_jets_pt.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_contamination_jets_pt.eps}
    \caption{Efficiency (left) and contamination (right) vs. transverse momentum
    for jets before and after the electron-jet cross-cleaning.}
\label{fig:effCont_Jets_ElecJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------


%\subsubsection{Resolution}
The transverse momentum and pseudorapidity spectrum for the electrons are shown
in Fig.~\ref{fig:objSpectra_ElecJet}. The distributions are normalized to one
and a change in shape can be observed in both of them. The number of low $p_T$
electrons is reduced after the cross-cleaning what corresponds to the observed
drop in efficiency at low $p_T$ due to identification and isolation
efficiencies. The slope of the generated $p_T$ distribution is recovered for
the higher transverse momenta, starting from 50\ GeV.

The spikes from fake electrons located at the transition region from barrel to
endcap calorimeter around $|\eta|=1.4$ are cleaned away.

% ------------------------------------------------------------------------------
\begin{figure}[htb]
\begin{center}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_noteV3_JpT0_obj_gen-reco_pt.eps}
    \includegraphics[scale=0.8]{figures/ElecJet/LM4_obj_eta.eps}
    \caption{Transverse momentum and pseudorapidity spectra before
    and after the electron-jet cross-cleaning. The generated $p_T$ spectrum is
    shown for comparison.}
\label{fig:objSpectra_ElecJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

Of further interest in an analysis is the spectrum of the so-called recoiled
missing transverse energy (recoil MET). It is calculated by adding up the
fourvectors of all objects (passing the ID) in the event, that is electrons,
muons, tau, jets, photons. The recoil MET quantity is very sensitive to
double counting of energy in the event.

The result for electron-jet cross cleaning is shown in Fig.~\ref{fig:met_ElecJet} in comparison to the missing transverse energy from the
calorimeter towers, corrected for the jet energy scale (L2, L3). While they are
in good agreement at the lower energy range (up to \(\sim 500~GeV)), the
distributions differ in the tail. The gap between 'recoil' and 'calo' missing
$E_T$ is closed by the cross-cleaner, demonstrating an effective removal of
overlaps and therefore double counting of energy.

% ------------------------------------------------------------------------------
\begin{figure}[htb]
\begin{center}
    \includegraphics[scale=1.1]{figures/ElecJet/LM4_METcomp.eps}
    \caption{Spectrum of missing transverse energy from fourvector sum of all
    particles before and after the electron-jet cross-cleaning. For comparison
    the missing $E_T$ from calorimeter towers is shown as well. The MET tail is
    clearly reduced by the removal of double conted energy by the cross-cleaning
    algorithms. The fact that calorimeter and recoil MET nicely agree after the
    cross cleaning is somewhat coincidental, as the recoil MET is correlated
    with the cuts on the electron and the jets summarized in Tab.~\ref{tab:PATobjCuts}.}
\label{fig:met_ElecJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------
The electron-jet cleaning seems a reasonable addition to the common
electron ID procedure. One can trade efficiency for purity (i.e. contamination)
by varying the isolation cut.

\clearpage

% *** MUON-JET CLEANING ********************************************************

\section{Muon - Jet Cleaning}
The idea behind the muon-jet cleaning is to merge those muons into the jet which
are produced inside this jet by decay-in-flight of b and c hadrons\footnote{The
same idea is pursued in the Jet Plus Track algorithms.}.

The user must take care not to include fake muons in the cleaning. Those can
result from punch-through of hadrons into the muon system and might have very
high transverse momentum which would spoil the jet collection. An appropriate
muon identification can be chosen from the muon POG defaults~\cite{muonID}.

The Muon-Jet cross cleaning was tested on the\\
\texttt{/SUSY\_LM4-sftsht/Summer08\_IDEAL\_V11\_redigi\_v1/GEN-SIM-RECO} and\\
\texttt{/ZmumuJet\_Pt80to120/Winter09\_IDEAL\_V11\_FastSim\_v1/GEN-SIM-DIGI-RECO}
Monte Carlo samples.

All plots in this section are obtained from the LM4 Sample using CMSSW 2.2.8.
The following CVS tags were used on top of this release:
\begin{itemize}
    \item DataFormats/PatCandidates V03-18-09      
    \item PhysicsTools/PatAlgos     V04-14-25      
    \item PhysicsTools/PatUtils     V03-05-02      
\end{itemize}
The PAT objects
were generated using the default sequences provided in the configuration
files\\
\texttt{PhysicsTools/PatAlgos/python/patLayer0\_cff.py} and\\
\texttt{PhysicsTools/PatAlgos/python/patLayer1\_cff.py}.

Some plots obtained from a $Z\rightarrow\mu\mu$ sample can be found in appendix~\ref{app:Zmumu}.


\subsection{Algorithm}
In this cross-cleaner module non-isolated muons are considered part of
any jet which is within a distance of $\Delta R=0.2$ away from them. Isolation refers either
to both tracker and calorimeter or the CombRelIso variable. The muon objects
are removed and their fourvector added to the jet object. 
%(To avoid any double counting of energy we subtract the MIP
%signal of the muon in the calorimeter which is already contained in the
%jet. Still to add in the code!)
This is sketched in Fig.~\ref{fig:MJCleaning}.

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
\begin{center}
\includegraphics[scale=.6]{figures/MuonJet/MuonJetAlgo_quer.eps}
\caption{Steps of the muon-jet cleaning.}
\label{fig:MJCleaning}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

The cut values on the distance between muon and jet and the muon isolation are configurable (see
Tab.~\ref{tab:MuonJetPar}). A switch has been introduced to turn off the
correction of the jet energy. This is meant to be used in combination with the
Jet-plus-Tracks algorithm~\cite{jpt} where the muon energy has already been added in the
jet reconstruction but the muon has not yet been removed.

\subsection{Validation}
\subsubsection{Cut Variables}
In the muon - jet cross cleaning the isolation is used to decide which muons
are candidates for removing. Figure~\ref{fig:MuonIsolation} shows the combined
isolation as defined in Eq.~(\ref{ElIsolation}) for muons before and after the
cleaning. The present isolation cut is $0.1$~GeV. 

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_iso_Muon_before.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_iso_Muon_after.eps}
    \caption{Combined isolation for muons before (left) and after (right) the
    muon-jet cross cleaning. Note, that only non-isolated muons close 
    to a jet are removed in the cleaning.}
\label{fig:MuonIsolation}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------


Next, the distance \(\Delta R\) between the (non-isolated) muon and all jets in
\(\eta - \phi\) space is calculated. If there exists a jet which is closer than
a certain value (the present default is \(\Delta R < 0.2\)), the muon will be
removed, otherwise both muon and jets will be left alone.
Fig.~\ref{fig:dR_MuonJet_noniso} shows the $\Delta R$ distribution before and
after the cross cleaning. As the energy correcion of the jet is a vectorial
correction (it is the same as described in the electron-jet cleaner), it may
happen that a jet, which is not in cleaning distance of a non-isolated muon
before the cleaning, is moved into cleaning distance after the cross cleaning.
This effect can be observed in the entries below $\Delta R=0.2$ in the right plot of Fig.~\ref{fig:dR_MuonJet_noniso}. It is very small and happens in less than \(0.01\) percent of leftover
non-isolated muons with a jet close-by (for the given jet and muon
cuts see Tab.~\ref{tab:PATobjCuts}).

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_dR_MuonJet_noniso_before.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_dR_MuonJet_noniso_after.eps}
    \caption{\(\Delta R\) between a non-isolated muon and a jet before (left) and
    after (right) the muon-jet cross cleaning.}
\label{fig:dR_MuonJet_noniso}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\subsubsection{Isolated Muons}
In the current implementation,
isolated muons are considered as particles which do not interact with the
detector except the tracker and the muon chambers.  Nevertheless, we observe a
peak in the \(\Delta R\) distribution between the isolated muon and the nearest
jet at small values (see left plot in Fig.~\ref{fig:dR_MuonJet_iso}).

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_dR_MuonJet_iso_before.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Pt_NJ_MuonJet_iso_before.eps}
    \caption{Left: \(\Delta R\) between an isolated muon and a jet before the
    muon-jet cross cleaning. Around \(15\%\) of the muons have a jet within a
    distance of \(\Delta R < 0.2\). Right: the (uncorrected) transverse momentum of the jets in this distance is small.}
\label{fig:dR_MuonJet_iso}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

Around \(15\%\) of the isolated muons have a jet within the distance of
\(\Delta R < 0.2\). These jets usually have a small uncorrected transverse
momentum (Fig.~\ref{fig:dR_MuonJet_iso}, right). About \(25\%\) of these muons
have a generator photon from the hard process within a distance of \(\Delta R <
0.3\), which could have caused such a jet. Another \(25\%\) of the muons have
some jet-constituents (i.e. generator particles like mesons, baryons,
photons, electrons) within that distance. 
%In these cases, the jet was produced by particles, whose
%energy was lost to the muon before its contact to the calorimeter (first case) or
%never part of the muon at all (second case) and therefore no double counted
%energy is present. 
The remaining 50\% of the muons have no generator particle
close-by. These jets could be caused by particleless detector interactions with
the muon, bremsstrahlung, or noise. 
%In the event of detector interactions or
%bremsstrahlung, there might be double counted energy, but these effects are
%likely small. 
The energy resolution for muons with and without a jet within
\(\Delta R < 0.2\) is shown in Fig.~\ref{fig:genPt_vs_recoPt_isoMuon}. The
muons with a jet within the given distance seem to be slightly more energetic,
but no clear difference in the resolution can be seen. 

A muon is not a calorimeter object, therefore there is no double counted
energy in the calorimeter by definition. For isolated muons no cross-cleaning
action is taken.
% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_genPt_vs_recoPt_MuonJet_NJMuons.eps}'
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_genPt_vs_recoPt_MuonJet_noNJMuons.eps}
    \caption{Resolution of the transverse momentum on generator level versus
the transverse momentum on reconstruction level for isolated muons with (left)
and without (right) a jet within \(\Delta R < 0.2\). Although the muons with a
jet in the named distance are in average more energetic than those without, the
resolution does not differ clearly.}
\label{fig:genPt_vs_recoPt_isoMuon}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\subsubsection{Selection Efficiency and Fake Rate}

The greatest influence of muon - jet cross cleaning is on the
contamination\footnote{contamination and efficiency are defined as in the
electron - jet cleaner} of the non-isolated muons. It drops from \(\sim 40 \%\)
to \(\sim 10 \%\) with the default settings. The selection efficiency for all
muons on the other hand also decreases to $\sim 90\%$. The
drop of the efficiency is mainly due to the cut on the isolation and, in a
smaller part, on the decision on what distance from the non-isolated muon to
search for a jet. The efficiency for all muons and the contamination of the
non-isolated ones is shown in Fig.~\ref{fig:effCont_muon_MuonJet} versus 
\(p_T\) and \(\eta\) the muons. 

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Eff_pt_Muons.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Eff_eta_Muons.eps}\\
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Cont_pt_Muons_noniso.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Cont_eta_Muons_noniso.eps}
    \caption{Efficiency (upper row) and contamination (lower row) vs.
    transverse momentum (left) and pseudorapidity (right) for muons before and
    after the muon-jet cross-cleaning. The efficiency is shown for all muons,
    while the contamination is shown only for the non-isolated muons. Note, that
    the difference in the muon reconstruction efficiency before and after the
    cross cleaning is determined by the removal of non-isolated muons and
    therefore by the muon isolation efficiency alone, similar to the
    electron-jet cleaning. }
\label{fig:effCont_muon_MuonJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

Again, this cross cleaning module has nearly no impact on selection efficiency
and contamination of the jets (cf. Fig.~\ref{fig:effCont_Jets_MuonJet}).

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Eff_pt_Jets.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Cont_pt_Jets.eps}
    \caption{Efficiency (left) and contamination (right) vs. transverse momentum
    for jets before and after the muon-jet cross-cleaning.}
\label{fig:effCont_Jets_MuonJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\subsubsection{Resolution}
As shown in the \(p_T\) spectrum of the muons in
Fig.~\ref{fig:ObjSpectra_MuonJet} (left), the cross cleaning effects mainly
the soft muons, located more centrally in terms of pseudorapidity (right).

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Spectrum_Muon_pt.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_Spectrum_Muon_eta.eps}
    \caption{\(p_T\) (left) and \(\eta\) (right) spectra for muons before and
    after the muon-jet cross cleaning.}
\label{fig:ObjSpectra_MuonJet}
\end{center}
\end{figure} 
% ------------------------------------------------------------------------------

On the recoil MET, defined as in section~\ref{sec:ElecJet}, the muon-jet cross
cleaning has nearly no effect (cf. Fig~\ref{fig:met_MuonJet}).

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/LM4_met_MuonJet.eps}
    \caption{Spectrum of missing transverse energy from fourvector sum of all
    particles before and after the muon-jet cross cleaning. For comparison the
    missing $E_T$ from calorimeter towers is shown as well.}
\label{fig:met_MuonJet}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\clearpage

% ******************************************************************************

\section{Photon - Jet Cleaning}
In the CMS default reconstruction photons are selected with rather loose
criteria from all reconstructed superclusters in the event. As in the case of
electrons an adequate photon identification must be applied in order to remove
fake and/or non-isolated photons. Any photon entering the cross-cleaning must
fulfill the requirements of a certain identification, which can be chosen from
the ones deployed by the EGamma POG \cite{photonID}. 

Again the energy deposit in the supercluster might also be part of a
calorimeter tower and thus be used in jet reconstruction. These ambiguities in
the assignment of energy to the objects are resolved in a scheme similar to the
electron-jet disambiguation described in section~\ref{sec:ElecJet}
(Fig.~\ref{fig:PJCleaning}).

%\subsection{Algorithm}

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
\begin{center}
\includegraphics[scale=.6]{figures/PhotonJetAlgo_quer.eps}
\caption{Steps of the photon-jet cleaning.}
\label{fig:PJCleaning}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\subsection{Validation}
The photon-jet cleaning must be studied on two different kinds of
events. On the one hand events which contain a high $p_T$ photon from the hard
interaction and on the other hand events having only soft photons from
radiation of other final state particles or their interactions with the
detector.

For the first case a photon-jet sample
\newline\texttt{/PhotonJetPt80/Summer08\_IDEAL\_V12\_redigi\_v1/GEN-SIM-RECO} is
used while
the latter is studied on the SUSY LM4 Monte Carlo used in the validation
of the electron-jet and the muon-jet cleaner, too.  The software setup is identical
to the electron-jet cleaning.

\subsubsection{Photon-Jet Events}
If a high $p_T$-photon is present in the event, in many cases
it is also reconstructed as a jet. The algorithm should detect these overlaps and
be able to preserve the photon while removing the jet.

All reconstructed photons are considered in the procedure and no
photon ID requirements are applied. So the first criterion in the algorithm is
the photon isolation in the calorimeter (ECAL+HCAL), whose distribution is
shown in Fig.~\ref{fig:pjPhotIso}. Photons having a matched generator photon
show a clear peak at small values motivating the cut which is applied at
$10$~GeV on the calorimeter isolation energy.
This selection defines the reconstruction efficiency after the cross-cleaning.
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=1.0]{figures/PhotJet/GammaJet80_noteV2_JpT15_isolation_B.eps}
    \caption{Photon calorimeter isolation in $\gamma$-jet events.}
    \label{fig:pjPhotIso}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

The photon-jet cleaning is based on the same quantities as the electron-jet
cleaning and their distributions show a similar behaviour. Real photons
with a generator match show a peak at high values in the distribution of the
ratio of shared
energy divided by the jet energy, while other contributions are evenly
spread over almost the entire range (Fig.~\ref{fig:pjSharedE}),  for these
photons the overlapping un-matched jet is clearly a fake.  A cut at $0.7$
on the ratio
is used here to decide whether to keep the jet or to discard it. Some overlaps
of non-isolated photons have a generator match as well and this fraction
determines the final reconstruction efficiency as mentioned before. After the
cleaning the distance in $\Delta R$ between photons and the closest jets shows
a smooth behaviour (Fig.~\ref{fig:pjDeltaR}) and the separation is improved. 
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_sharedE_iso_B.eps}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_sharedE_noniso_B.eps}
    \caption{Ratio of shared energy of photon and jet divided by the jet's raw
    energy. Left: isolated photons. The peak corresponds to real generator
    matched photons that are reconstructed as jet (without generator match) as
    well. Right: non-isolated photons.}
    \label{fig:pjSharedE}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_dR_iso_B.eps}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_dR_iso_A.eps}
    \caption{Distance in $\Delta R$ between photon and overlapping jet in
    $\gamma$-jet events before (left) and after (right) the photon - jet cleaning.}
    \label{fig:pjDeltaR}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

Studying the effect of the cross-cleaning one finds as expected that in most
cases only one photon is left in the event after the cleaning
(Fig.~\ref{fig:pjPhotMult}). The $p_T$ spectrum of reconstructed photons
(Fig.~\ref{fig:pjPhotCont}) shows that mainly soft photons have been removed.
The slope compares well to the spectrum of generator photons for transverse
momenta above 80\ GeV. The amount of softer photons is strongly reduced,
however an excess remains after the cleaning. One should keep in mind that no
photon ID has been applied here.
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=1.0]{figures/PhotJet/GammaJet80_obj_multiplicity.eps}
    \caption{Photon multiplicity in $\gamma$-jet events before and after the
    photon - jet cross-cleaning.}
    \label{fig:pjPhotMult}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_noteV2_JpT15_obj_gen-reco_pt.eps}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_contamination_jets_pt.eps}
    \caption{Left: $p_T$ spectrum for generated and reconstructed photons
    before and after the photon-jet cross-cleaning. Right: jet contamination
    versus the jet $p_T$.}
    \label{fig:pjPhotCont}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

Another effect we observe is a drop in the contamination of the jets.
Contamination is defined here as the fraction of reconstructed jets without a
match to a generated parton. This is shown versus the transverse momentum of
the jet in the right plot of Fig.~\ref{fig:pjPhotCont}. A reduction in the
order of 40-60\%, increasing with jet $p_T$ can be observed. Jets identified as
photons are removed what leads to this improvement.

In the initial distribution of recoil MET (red line in
Fig.~\ref{fig:pjMET}) a peak at 100\ GeV is observed, corresponding to the
transverse momenta of the hard photons in this Monte Carlo sample. Clearly, a
double counting of energy has taking place.  After the photon-jet cleaning this
peak is significantly smaller (blue line in the left plot of
Fig.\ref{fig:pjMET}) but only after additional electron-jet cleaning the
recoil missing $E_T$ becomes compatible to the calorimeter MET (right plot in
Fig.~\ref{fig:pjMET}). Obviously, many of the jets and/or photons are
also reconstructed as electrons so that energy has even been triple counted.
% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_METcomp.eps}
    \includegraphics[scale=0.8]{figures/PhotJet/GammaJet80_addElecJet_METcomp.eps}
    \caption{Recoil missing $E_T$ in $\gamma$-jet events. Left: before and
    after the photon-jet cross-cleaning. Right: before and after the photon-
    and electron-jet cleaning. The missing $E_T$ from the calorimeter is shown
    for comparison.}
    \label{fig:pjMET}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

\clearpage
\subsubsection{SUSY Sample}
In SUSY events in the LM4 scenario no high $p_T$-photons are produced in the
decay chains of squarks and gluons. Therefore, all reconstructed photons are rather soft and only very
few have match on generator level. The expectation is that most of the
photons overlap with jets and should be removed in the cleaning procedure.

This can actually be observed in the change of photon multiplicity due to the
cleaning (Fig.~\ref{fig:pjLM4mult}). Less than one third of the events still
contain a photon afterwards.

This has a large impact on the distribution of recoil MET whose high $E_T$ tail
is strongly reduced (Fig.~\ref{fig:pjLM4MET}). Again we find that the
combination of photon- and electron-jet cleaning leads to a good agreement with
the calorimeter missing $E_T$.

% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
      \includegraphics[scale=0.8]{figures/PhotJet/LM4_noteV2_JpT15_obj_multiplicity.eps}
    \caption{Photon multiplicity in LM4 events before and after the photon-jet
    cross-cleaning.}
    \label{fig:pjLM4mult}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{figure}[hbtp]
  \begin{center}
      \includegraphics[scale=0.8]{figures/PhotJet/LM4_noteV2_JpT15_METcomp.eps}
      \includegraphics[scale=0.8]{figures/PhotJet/LM4_noteV2_JpT15_addElecJet_METcomp.eps}
    \caption{Missing transverse energy in SUSY LM4 events after photon-jet
    cleaning (left) and photon- plus electron-jet cleaning (right). Shown are
    the recoil MET before cleaning (red), after cleaning (blue) and the
    calorimeter MET (green).}
    \label{fig:pjLM4MET}
  \end{center}
\end{figure}
% ------------------------------------------------------------------------------


% ******************************************************************************

\clearpage
\section{Electron - Photon Cleaning}
Both kinds of objects are reconstructed from superclusters in the
electromagnetic calorimeter. Before object identification procedures are
applied the electron collection is just a subset of the photon collection with
the additional requirement that a track matches the supercluster. For
disambiguation it is necessary to remove those photons which share the
supercluster seed or even the supercluster with a good electron.  Therefore, the
reference to the supercluster (seed) of all electron-photon pairs in the event
are compared and duplicates are removed from the photon collection
(Fig.~\ref{fig:EPCleaning}). The electron collection is not affected by this
module. This module does not have configurable parameters.

% ------------------------------------------------------------------------------
\begin{figure}[hbt]
\begin{center}
\includegraphics[scale=.6]{figures/ElectronPhotonAlgo_quer.eps}
\caption{Steps of the electron-photon cleaning.}
\label{fig:EPCleaning}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

%\subsection{Validation}
%\clearpage

% *** CONCLUSIONS **************************************************************

\section{Combined Cleaning}
For an optimal cleaning in an analysis considering several or all of the
different objects the discussed parts can be used simultaneously. The individual
cleaners are run one after the other, all adding information to the internal
map. After that the map is checked for consistency (cf. Section~\ref{mapReso}).

The outcome of the combined cleaning should be events with no double counted
energy at all. This can be checked, e.g. in the distribution of the
missing $E_T$ from object fourvectors (recoil MET) and the calorimeter MET
(Fig.~\ref{fig:allMET}). For the SUSY LM4 sample we observe a very good
agreement after the cleaning, demonstrating the successful removal of all doubly
counted energy.

% ------------------------------------------------------------------------------
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=1.0]{figures/All/LM4_noteV3_JpT0_none_METcomp.eps}
    \caption{Spectrum of missing transverse energy from fourvector sum of all
    particles before and after all cross-cleanings. For comparison
    the missing $E_T$ from calorimeter towers is shown as well.}
\label{fig:allMET}
\end{center}
\end{figure}
% ------------------------------------------------------------------------------

\clearpage
%\section{Conclusions}

% *** DOCUMENTATION ************************************************************

%\clearpage
\section{Documentation}
Instructions how to obtain the code, compile and run it, and use its
output are maintained on a CMS wiki page~\cite{twiki}. Examples on how to
configure the package are linked from this page. New versions of the package
are advertised on the page on SUSY specific PAT extensions~\cite{susypat}.


\section{Acknowledgments}
We like to thank Oliver Buchm\"uller, Filip Moortgat, Fr\'ed\'eric Ronga,  Luc
Pape, and the SUSY group for the fruitful discussions, shared ideas, and
support.

%% *** USER VALIDATION **********************************************************
%
% \section{User Validation}
%The CMSSW module and a set of configuration files and ROOT scripts used to
%generate the plots in this note are available on CVS. Instructions on how to
%use them can be found on the wiki page~\cite{twiki}.

% *** APPENDIX - CONFIG PARAMETERS *********************************************

%\clearpage
\begin{appendix}
\section{Configurable Parameters}
% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Turning on and off the components}
\begin{center}
\begin{tabular}{l|l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Description} & \textbf{Default
    Setting} \\ \hline
    bool & doElectronJetCC   & Turn on/off electron-jet cleaning & True
    \\\hline
    bool & doPhotonJetCC     & Turn on/off photon-jet cleaning  & False
    \\\hline
    bool & doMuonJetCC       & Turn on/off muon-jet cleaning     & True
    \\\hline
    bool & doElectronPhotonCC& Turn on/off electron-photon cleaning & True
\end{tabular}
\end{center}
\label{tab:TurnOnModules}
\end{table}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Choosing the input collections}
\begin{center}
\begin{tabular}{l|l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Description} & \textbf{Default
Setting} \\ \hline
InputTag & patJets      & Input jet collection   & selectedLayer1Jets
\\\hline
InputTag & patMets      & Input MET collection   & selectedLayer1METs
\\\hline
InputTag & patMuons     & Input muon collection  & selectedLayer1Muons
\\\hline
InputTag & patElectrons & Input electron collection &
selectedLayer1Electrons 
\\\hline
InputTag & patPhotons   & Input photon collection& selectedLayer1Photons
%\\\hline
%InputTag & patTaus      & Input tau collection   & selectedLayer1Taus
\end{tabular}
\end{center}
\label{tab:InputCollections}
\end{table}
% ------------------------------------------------------------------------------
% WHAT ABOUT CALO TOWER COLLECTION? IS IT STILL USED?

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Jet Corrections}
\begin{center}
\begin{tabular}{l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Default Setting}       \\\hline
string &L1JetCorrector       & "none"                          \\\hline 
string & L2JetCorrector      & "L2RelativeJetCorrectorIC5Calo" \\\hline
string & L3JetCorrector      & "L3AbsoluteJetCorrectorIC5Calo" \\\hline
string & L4JetCorrector      & "none"                          \\\hline
string & L5udsJetCorrector   & "none"                          \\\hline
string & L5gluonJetCorrector & "none"                          \\\hline
string & L5cJetCorrector     & "none"                          \\\hline
string & L5bJetCorrector     & "none"                          \\\hline
string & L6JetCorrector      & "none"                          \\\hline
string & L7udsJetCorrector   & "L7PartonJetCorrectorIC5qJet"   \\\hline
string & L7gluonJetCorrector & "L7PartonJetCorrectorIC5gJet"   \\\hline
string & L7cJetCorrector     & "L7PartonJetCorrectorIC5cJet"   \\\hline
string & L7bJetCorrector     & "L7PartonJetCorrectorIC5bJet" 
\end{tabular}
\end{center}
\label{tab:JetCorrections}
\end{table}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Parameters for electron-jet cleaning}
\begin{center}
\begin{tabular}{l|l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Description} & \textbf{Default
Setting}                                                            \\\hline
double & DeltaR\_min       &
\begin{minipage}[t]{8cm}Check for overlaps within a cone of this size around
    the electron \\
\end{minipage} & 1.                                              \\\hline
double & SharedEtoJetE     &
\begin{minipage}[t]{8cm} Ratio of shared energy to jet energy. Used for
    decision whether to drop the jet if the electron is isolated
\end{minipage} & 0.7                                                \\\hline
double & IsoValueCut       & Cut on isolation & 0.1                 \\\hline
%double & SharedEForNIsoEle & 
%\begin{minipage}[t]{8cm}Lower energy threshold for non-isolated electrons to
%    be merged into a jet
%\end{minipage} & -1.  (disabled)                                    \\\hline
string & IsolationKey      &
\begin{minipage}[t]{8cm} Key to choose isolation method as defined in
    DataFormats/PatCandidates/interface/Isolation.h\\
    The combined relative isolation recommended by the V+jets group can be
    selected as ``CombRelIso''
\end{minipage} & ``CombRelIso''                                        \\\hline
string & ElectronID        &
\begin{minipage}[t]{8cm}Key to choose cut-based identification method. Valid
    choices are: eidLoose, eidRobustHighEnergy, eidRobustLoose,
    eidRobustTight, eidTight. The names correspond to the modules defined by
    the EGamma POG in
    RecoEgamma/ElectronIdentification/python/ electronIdSequence\_cff.py\\
\end{minipage} & ``eidRobustLoose''   \\\hline
double & ecalIsoWeight & Weight of ecal isolation in CombRelIso variable & 1. \\\hline
double & hcalIsoWeight & Weight of hcal isolation in CombRelIso variable & 1. \\\hline
double & trkIsoWeight  & Weight of tracker isolation in CombRelIso variable & 1.
\end{tabular}
\end{center}
\label{tab:ElectronJetPar}
\end{table}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Parameters for muon-jet cleaning}
\begin{center}
\begin{tabular}{l|l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Description} & \textbf{Default
    Setting} \\ \hline
    double & DeltaR\_min &
    \begin{minipage}[t]{8cm}Check muons within a cone of this size around
	the jet.
    \end{minipage}                                           & 0.2 \\\hline
    double & caloIso\_max    & Cut on calorimeter isolation. & 10.\\\hline
    double & trackIso\_max   & Cut on track isolation.       & 10.\\\hline
    string & MuonID          & 
    \begin{minipage}[t]{8cm} Key to choose identification method. All
	possible choices are defined in
	DataFormats/MuonReco/interface/Muon.h. The MuonAnalysis page
	provides more information on these methods. In case of an invalid
	parameter choice the 'AllGlobalMuons' are used. \\
    \end{minipage}                             & ``GlobalMuonPromptTight''\\\hline
    bool   & modifyJetEnergy &
    \begin{minipage}[t]{8cm} Add energy of the muon to the overlapping jet.
	Should be set to false for the use with JPT.\\
    \end{minipage}                                            & True\\\hline
    bool   & useCombRelIso   & 
    \begin{minipage}[t]{8cm}
      will use the combined isolation variable defined by the V+jets group
      instead of caloIso\_max or trackIso\_max
    \end{minipage}                                            & True\\\hline
    double & IsoValueCut     & Cut on CombRelIso              & 0.1\\\hline
    double & ecalIsoWeight   & 
    \begin{minipage}[t]{8cm}
      Weight of ecal isolation in CombRelIso variable
    \end{minipage}                                            & 1.\\\hline
    double & hcalIsoWeight   & 
    \begin{minipage}[t]{8cm}
      Weight of hcal isolation in CombRelIso variable
    \end{minipage}                                            & 1.\\\hline
    double & trkIsoWeight    & 
    \begin{minipage}[t]{8cm}
      Weight of tracker isolation in CombRelIso variable
    \end{minipage}                                            & 1.
\end{tabular}
\end{center}
\label{tab:MuonJetPar}
\end{table}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\begin{table}[h]
\caption{Parameters for photon-jet cleaning}
\begin{center}
\begin{tabular}{l|l|l|l}
\textbf{Type} & \textbf{Name} & \textbf{Description} & \textbf{Default
Setting}                                                            \\\hline
double & DeltaR\_min       &
\begin{minipage}[t]{8cm}Check for overlaps within a cone of this size around
    the photon \\
\end{minipage} & 0.5                                               \\\hline
double & IsoValueCut       & Cut on isolation & 10.                 \\\hline
string & IsolationKey      &
\begin{minipage}[t]{8cm} Key to choose isolation method as defined in
    DataFormats/PatCandidates/interface/Isolation.h\\
\end{minipage} & ``CaloIso''                                        \\\hline
double & SharedEtoJetE     &
\begin{minipage}[t]{8cm} Ratio of shared energy to jet energy. Used for
    decision whether to drop the jet if the photon is isolated
\end{minipage} & 0.7                                                \\\hline
string & PhotonID        &
\begin{minipage}[t]{8cm}Key to choose cut-based identification method. Valid
    choices are: LooseEM, LoosePhoton, TightPhoton or 'none'. For further
    information see the Photon ID wiki page~\cite{photonID}
\end{minipage} & ``LooseEM''  
\end{tabular}
\end{center}
\label{tab:PhotonJetPar}
\end{table}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\clearpage
\section{Muon-Jet Cross Cleaning on Z$ \rightarrow \mu\mu$}
\label{app:Zmumu}
The dataset used here was \texttt{/ZmumuJet\_Pt80to120/Winter09\_IDEAL\_V11\_FastSim\_v1/GEN-SIM-DIGI-RECO}
\newline
\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/Zmumu_Eff_pt_Muons.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/Zmumu_Eff_eta_Muons.eps}\\
    \includegraphics[scale=0.8]{figures/MuonJet/Zmumu_Cont_pt_Muons_noniso.eps}
    \includegraphics[scale=0.8]{figures/MuonJet/Zmumu_Cont_eta_Muons_noniso.eps}
    \caption{Effiency (upper row) and contamination (lower row) vs. transverse
    momentum (left) and pseudorapidity (right) for all (efficiency) and non-isolated (contamination) muons before and after the
    muon-jet cross-cleaning done on a \(Z\rightarrow\mu\mu\) sample.}
    \label{fig:effCont_muon_MuonJet_Zmumu}
\end{center}
\end{figure}

\begin{figure}[hb]
\begin{center}
    \includegraphics[scale=0.8]{figures/MuonJet/Zmumu_Mult_Muons.eps}
    \caption{Muon multiplicity before and after the muon-jet cross-cleaning
    done on a \(Z\rightarrow\mu\mu\) sample.}
    \label{fig:muon_mult_MuonJet_Zmumu}
\end{center}
\end{figure}


% ------------------------------------------------------------------------------

\end{appendix}

% *** BIBLIOGRAPHY *************************************************************
\pagebreak
\begin{thebibliography}{9}
\bibitem {package} {\bf The CVS code repository},
\underline{http://cmssw.cvs.cern.ch/cgi-bin/cmssw.cgi/UserCode/SusyAnalysis/PatCrossCleaner/}

\bibitem {twiki} {\bf Cross-cleaning package online documentation},
\underline{https://twiki.cern.ch/twiki/bin/view/CMS/SusyPatCrossCleaner/}

\bibitem {wikiSusyAnalyzer} {\bf SusyAnalyzer online documentation}
\underline{https://twiki.cern.ch/twiki/bin/view/CMS/SusyAnalyzer}

\bibitem {susypat} {\bf SUSY PAT online documentation},
\underline{https://twiki.cern.ch/twiki/bin/view/CMS/SusyPat/}

\bibitem{muonID} {\bf Muon Identification in CMS}, CMS AN-2008/098 

\bibitem{elecID} {\bf A cut based method for electron identification in CMS}, CMS AN-2008/082 

\bibitem{photonID} {\bf Photon ID Analysis online documentation} 
\underline{https://twiki.cern.ch/twiki/bin/view/CMS/PhotonIDAnalysis}

\bibitem {vplusjets} {\bf V+Jets Cross-PAG online documentation},
\underline{https://twiki.cern.ch/twiki/bin/view/CMS/VplusJets}

\bibitem{jpt} {\bf Jet Energy Correction with Charged Particle Tracks in CMS}, CMS Note-2004/015 

\end{thebibliography}

% ******************************************************************************

\end{document}
